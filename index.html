<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pasay Konek Portal</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<div id="adminTutorialModal" class="modal-overlay hidden">
  <div class="modal-content" style="max-width: 380px;">
    <div class="emergency-header">
      <h3 style="margin: 0; font-size: 1.1rem; color: #006633;">Admin Dashboard Guide</h3>
    </div>
    <div style="text-align: left; margin-top: 15px; font-size: 0.9rem; line-height: 1.6;">
      <p><strong>1. Filter & Search:</strong> Use the sidebar to filter reports by Status or Category, or search for a specific Tracking ID.</p>
      <p><strong>2. Update Status:</strong> Change a report's status (e.g., to "In Progress" or "Resolved") to keep residents informed.</p>
      <p><strong>3. Analytics:</strong> Click <i>"View City Analytics"</i> to see visual data and trends of reported issues.</p>
      <p><strong>4. Export Data:</strong> Download all records as a CSV file for official documentation and offline reporting.</p>
      <p><strong>5. Clear Data:</strong> This button is for system maintenance; it permanently deletes all registered user accounts from the database.</p>
    </div>
    <button onclick="toggleAdminTutorial(false)" class="btn-primary" style="width: 100%; margin-top: 15px; padding: 10px;">Got it!</button>
  </div>
</div>

<button id="adminTutorialBtn" onclick="toggleAdminTutorial(true)" title="Admin Help" style="width: 45px; height: 45px; padding: 0; position: fixed; right: 20px; bottom: 75px; background-color: #FFCC00; border-radius: 50%; display: none; justify-content: center; align-items: center; border: 2px solid #006633; cursor: pointer; z-index: 2500; box-shadow: 0 4px 10px rgba(0,0,0,0.3);">
  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#006633" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
    <circle cx="12" cy="12" r="10"></circle>
    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
    <line x1="12" y1="17" x2="12.01" y2="17"></line>
  </svg>
</button>
<body>
  <div class="container page" id="loginPage">
    <div class="logo-container">
      <img src="IMG/pasay1.png" alt="Pasay City Logo" class="logo-img">
    </div>
    <h2>Pasay Konek Portal</h2>
    <p>Help us build a better city.</p>
    <form id="loginForm">
      <input type="text" id="username" placeholder="Username" required />
      <input type="password" id="password" placeholder="Password" required />
      <button type="submit">Login</button>
    </form>
    <p>Don't have an account? <a href="#" onclick="showRegister()">Register here</a></p>
  </div>

  <button id="tutorialBtn" onclick="toggleTutorialModal(true)" title="How to use" style="width: 45px; height: 45px; padding: 0; position: fixed; right: 20px; bottom: 75px; background-color: #006633; border-radius: 50%; display: flex; justify-content: center; align-items: center; border: 2px solid white; cursor: pointer; z-index: 2500;">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="10"></circle>
      <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
      <line x1="12" y1="17" x2="12.01" y2="17"></line>
    </svg>
  </button>

  <button id="emergencyBtn" onclick="toggleEmergencyModal(true)" title="Hotlines" style="width: 45px; height: 45px; padding: 0; position: fixed; right: 20px; bottom: 20px;">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
    <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
    </svg>
  </button>

  <div id="tutorialModal" class="modal-overlay hidden">
    <div class="modal-content" style="max-width: 350px;">
      <div class="emergency-header">
        <h3 style="margin: 0; font-size: 1.1rem; color: #006633;">User Guide</h3>
      </div>
      <div style="text-align: left; margin-top: 15px; font-size: 0.9rem; line-height: 1.6;">
        <p><strong>1. Reporting:</strong> Fill out the form in the dashboard. Ensure you select the correct Barangay and Street for faster response.</p>
        <p><strong>2. Evidence:</strong> Always attach a clear photo of the concern (e.g., potholes, uncollected garbage).</p>
        <p><strong>3. Status Meaning:</strong> 
          <br>• <span style="color: #666;">Pending</span> - Recently submitted.
          <br>• <span style="color: #007bff;">In Progress</span> - Currently being addressed.
          <br>• <span style="color: #28a745;">Resolved</span> - Issue has been fixed.
        </p>
        <p><strong>4. Communication:</strong> Click on your report to open the chat box and talk to the City Admin for updates.</p>
      </div>
      <button onclick="toggleTutorialModal(false)" class="btn-primary" style="width: 100%; margin-top: 15px; padding: 10px;">Got it!</button>
    </div>
  </div>

  <div id="emergencyModal" class="modal-overlay hidden">
  <div class="modal-content emergency-modal">
    <div class="emergency-header">
      <h3 style="margin: 0; font-size: 1.1rem; color: #e74c3c;">Emergency Hotlines</h3>
    </div>
    <div class="hotline-list">
      <div class="hotline-item"><span>Pasay Rescue</span> <a href="tel:88338512">8833-8512</a></div>
      <div class="hotline-item"><span>BFP (Fire)</span> <a href="tel:88442120">8844-2120</a></div>
      <div class="hotline-item"><span>Police</span> <a href="tel:88312133">8831-2133</a></div>
      <div class="hotline-item"><span>PCGH Hospital</span> <a href="tel:88336027">8833-6027</a></div>
    </div>
    <button onclick="toggleEmergencyModal(false)" class="btn-primary" style="width: 100%; margin-top: 10px; padding: 8px;">Close</button>
    </div>
  </div>

  <div class="container page hidden" id="registerPage">
    <h2>Resident Registration</h2>
    <form id="registerForm">
      <input type="text" id="regUsername" placeholder="Username" required />
      <input type="email" id="regEmail" placeholder="Email Address" required />
      <select id="regGender" required>
        <option value="" disabled selected>Select Gender</option>
        <option value="Male">Male</option>  
        <option value="Female">Female</option>
        <option value="Prefer not to say">Prefer not to say</option>
      </select>
      <input type="password" id="regPassword" placeholder="Password" required />
      <input type="password" id="regConfirmPassword" placeholder="Confirm Password" required />
      
      <div class="privacy-container">
        <input type="checkbox" id="privacyConsent" required />
        <label for="privacyConsent">
          I agree to the <span class="privacy-link" onclick="togglePrivacyModal(true)">Data Privacy Terms</span>. 
          I understand that the City Hall guarantees my data safety and assumes legal liability/compensation 
          if my privacy is compromised due to system failure.
        </label>
      </div>

      <button type="submit">Register Account</button>
    </form>
    <p>Already have an account? <a href="#" onclick="showLogin()">Login here</a></p>
  </div>
  
  <div class="main-content page hidden" id="dashboardPage">
    <header class="dashboard-header">
      <h2>Resident Dashboard</h2>
      <p>Welcome, <span id="currentUser"></span>!</p>
      <button onclick="logout()" class="btn-secondary">Logout</button>
    </header>
    
    <section class="submit-issue-section">
      <h3>Report a Concern</h3>
      <form id="issueForm">
        <input type="text" id="issueTitle" placeholder="Concern Title (e.g., Broken Stoplight)" required />
        
        <div class="location-group" style="display: flex; gap: 10px; margin-bottom: 10px;">
          <select id="issueBarangay" required onchange="populateStreets()">
            <option value="" disabled selected>Select Barangay</option>
            </select>
          
          <select id="issueStreet" required disabled>
            <option value="" disabled selected>Select Street</option>
          </select>
        </div>

        <select id="issueCategory" required>
          <option value="" disabled selected>Select Category</option>
          <option value="Garbage Collection">Garbage Collection</option>
          <option value="Traffic & Stoplights">Traffic & Stoplights</option>
          <option value="Road Maintenance">Road Maintenance / Potholes</option>
          <option value="Street Lighting">Street Lighting</option>
          <option value="Public Safety">Public Safety</option>
          <option value="Others">Others</option>
        </select>
        
        <textarea id="issueDesc" placeholder="Describe specific details of the issue and also street..." rows="4" required></textarea>
        
        <label for="issueImage">Attach Photo Evidence:</label>
        <input type="file" id="issueImage" accept="image/*" />
        <button type="submit">Submit Report</button>
      </form>
    </section>

    <section class="my-issues-section">
      <h3>My Submitted Reports</h3>
      <div id="issuesList" class="issue-grid scrollable-panel"></div>
    </section>
  </div>

  <div class="main-content page hidden" id="adminDashboardPage">
    <header class="dashboard-header">
      <div class="header-left">
        <h2>City Admin Dashboard</h2>
      </div>
      <div class="header-right">
        <button id="adminLogout" class="btn-secondary">Logout</button>
      </div>
    </header>
     
    <div id="issuesSection" class="filters-and-issues">
      <aside class="sidebar">
        <h3>Report Filters</h3>
        <div class="filters-group">
          <label for="statusFilter">Status</label>
          <select id="statusFilter">
            <option value="all">All Statuses</option>
            <option value="Pending">Pending</option>
            <option value="In Progress">In Progress</option>
            <option value="Resolved">Resolved</option>
          </select>
        </div>
        <div class="filters-group">
          <label for="categoryFilter">Category</label>
          <select id="categoryFilter">
            <option value="all">All Categories</option>
            <option value="Garbage Collection">Garbage Collection</option>
            <option value="Traffic & Stoplights">Traffic & Stoplights</option>
            <option value="Road Maintenance">Road Maintenance</option>
            <option value="Street Lighting">Street Lighting</option>
            <option value="Public Safety">Public Safety</option>
            <option value="Others">Others</option>
          </select>
        </div>
        <div class="filters-group">
          <label for="searchIssues">Search Report ID</label>
          <input type="text" id="searchIssues" placeholder="Enter ID..." />
        </div>
        <div class="admin-action-buttons">
          <button id="exportCSV" class="btn-primary">Export Data</button>
          <button id="deleteAllUsers" class="btn-danger">Clear Data</button>
        </div>
      </aside>

      <main class="admin-main-content">
        <div class="dashboard-topbar">
          <h3 class="card-title">All City Concerns</h3>
          <div class="topbar-right">
            <button id="viewAnalyticsBtn" class="btn-primary">View City Analytics</button>
          </div>
        </div>
        <div id="adminIssuesList" class="issue-grid scrollable-panel"></div>
      </main>
    </div>
  </div>

  <div class="main-content page hidden" id="analyticsPage">
    <div class="analytics-container">
      <header class="dashboard-header small-header">
        <h2>City Statistics Overview</h2>
        <button id="backToIssuesBtn" class="btn-secondary">Back to Reports</button>
      </header>
      <section class="analytics-section compact">
        <div class="analytics-cards">
          <div class="analytic-card" id="totalIssuesCard">Total Reports: 0</div>
          <div class="analytic-card" id="pendingIssuesCard">Pending: 0</div>
          <div class="analytic-card" id="progressIssuesCard">Fixing: 0</div>
          <div class="analytic-card" id="resolvedIssuesCard">Resolved: 0</div>
        </div>
        <div class="chart-wrapper">
          <canvas id="issuesByCategoryChart"></canvas>
        </div>
      </section>
    </div>
  </div>

  <div id="privacyModal" class="modal-overlay hidden">
    <div class="modal-content">
      <h3>Data Privacy & City Liability</h3>
      <p>
        The <b>Pasay City Feedback Portal</b> is committed to protecting your personal information under the 
        Data Privacy Act of 2012. 
      </p>
      <p>
        <b>Our Guarantee:</b> Your identity and report details are encrypted. If any data breach occurs due to 
        the city's technical negligence, <b>Pasay City Hall</b> assumes full legal responsibility and will provide 
        just compensation for any damages caused.
      </p>
      <button onclick="togglePrivacyModal(false)" class="btn-primary">I Understand</button>
    </div>
  </div>

  <div id="toast-container" aria-live="polite"></div>
  <div id="imageModal" class="modal-overlay hidden" onclick="closeImageModal()">
    <div class="modal-content-wrapper">
        <img id="modalImg" src="" alt="Full Preview">
    </div>
  </div>

  <script>
    function toggleTutorialModal(show) {
      const modal = document.getElementById('tutorialModal');
      if (show) modal.classList.remove('hidden');
      else modal.classList.add('hidden');
    }
    function togglePrivacyModal(show) {
      const modal = document.getElementById('privacyModal');
      if (show) modal.classList.remove('hidden');
      else modal.classList.add('hidden');
    }
  </script>
  <script src="script.js"></script>
</body>
</html>
